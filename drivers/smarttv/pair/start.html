<script>

Homey.setTitle( __('pair.start.title') );

Homey.on('done', function (data) {
	
	if (typeof data === 'undefined' || data == ""|| !data) {
		
		document.getElementById('discovery').style.display = 'none';
		document.getElementById('manualpair').style.display = 'block';	
		
	} else {
		
		Homey.showView('list_devices');
		
	}
	
});

Homey.on('fill', function(data) {
	$('#Name').val(data['name']);
	$('#ipAddress').val(data['ip']);
	
	document.getElementById('tempdata').innerHTML = JSON.stringify(data);
	
});

Homey.on('continue', function( success, callback ){
		Homey.showView('list_devices');
});

Homey.on('error', function (error) {
	
	document.getElementById('tempdata').innerHTML = error.message;
	
});

function saveSettings () {
	
	$('#save').prop('disabled', true);
	Homey.addDevice({
	    data: { // this data object is saved to- and unique for the device. It is passed on the get and set functions as 1st argument
	        id: $('#ipAddress').val()
	    },
	    settings: {
		    'ipaddress': $('#ipAddress').val()
	    },
	    name: $('#Name').val(),
	    capabilities: [
        	'onoff',
        	'volume_set'

        ]
	}, function( err, result ){
	    if( err ) return console.error(err);
	    console.log( result);
	    
	    Homey.emit ('manual_add', {
		    data: { // this data object is saved to- and unique for the device. It is passed on the get and set functions as 1st argument
		        id: $('#ipAddress').val()
		    },
		    settings: {
			    'ipaddress': $('#ipAddress').val()
		    },
		    name: $('#Name').val(),
		    capabilities: [
	        	'onoff',
	        	'volume_set'
	        ]
		});
	    
	    Homey.done();
	});
	
}

function requestpairingkey() {
	
	Homey.emit('requestpairingkey', {ip: $('#ipAddress').val()}, function (err, result) {
		
		console.log(result);
		
	});
	
}

Homey.emit('get_devices');

</script>
	<style>
		#pairSettings {
			font-size:16px;
			border:none;
		}

		input {
			font-size:16px;
		}

	</style>
	
	<div id="discovery">
		<p data-i18n="pair.start.discovery"></p>
	</div>
	<div id="manualpair" style='display: none'>
    	<p data-i18n="pair.start.intro">enter IP address</p>
		
		<div id="tempdata">
			
		</div>

		<table id="pairSettings">
			<tr>
				<td style="width:100px;" data-i18n="pair.start.Name">Name</td>
				<td><input id="Name" type="text" value="" placeholder="LG SmartTV"/></td>
			</tr>
			<tr>
				<td style="width:100px;" data-i18n="pair.start.ipAddress">IP</td>
				<td><input id="ipAddress" type="text" value="" placeholder="192.168.1.123"/></td>
			</tr>
			<tr>
				<td colspan="2"><button class="button" id="requestpairingkey" onclick="requestpairingkey()" data-i18n="pair.start.requestpairingkey">Request pairing key</button></td>
			<tr>
				<td style="width:100px" data-i18n="pair.start.pairingkey">Pairing Key</td>
				<td><input id="pairingkey" type="text" value="" placeholder=""></td>
			</tr>
				
		</table>
		
		<p>&nbsp;</p>
		<fieldset>
			<button class="button" id="save" data-i18n="pair.start.saveSettings" onclick="saveSettings()">Save</button>
		</fieldset>
	</div>
	
		